local mod = {}

local Camera = { 
    targetUnit = nil,

    shakeStarted = false,
    shakeTimeLeft = 0,
    shakeDelayTime = 0
}
Camera.__index = Camera
function Camera:new(targetUnit)
    local camera = {}
    setmetatable(camera, Camera)

    DCEI.SetCameraDistanceSmooth(20)

    camera.targetUnit = targetUnit
    
    camera.shakeStarted = false
    camera.shakeTimeLeft = 0
    camera.shakeDelayTime = 0

    return camera
end
function Camera:Update(deltaTime)
    if not self.shakeStarted then
        if self.targetUnit == nil then
            return
        end

        local position = DCEI.GetUnitPosition2D(self.targetUnit)
        DCEI.SetCameraFocusSmooth(position.x, position.y, true)
    else
        if self.shakeDelayTime <= 0 then
            self.shakeTimeLeft = self.shakeTimeLeft - deltaTime
            if self.shakeTimeLeft <= 0 then
                self.shakeStarted = false
                self.shakeTimeLeft = 0
            end
        end
    end

    if self.shakeDelayTime > 0 then
        self.shakeDelayTime = self.shakeDelayTime - deltaTime
        if self.shakeDelayTime <= 0 then
            self.shakeStarted = true
        end
    end
end
function Camera:UpdateTarget(targetUnit)
    self.targetUnit = targetUnit
end
function Camera:GetTargetUnit()
    return self.targetUnit
end
function Camera:StartShake(shakeTime, shakeDelayTime)
    self.shakeTimeLeft = shakeTime
    self.shakeDelayTime = shakeDelayTime
end

mod.Camera = Camera
return mod